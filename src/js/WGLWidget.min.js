WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WGLWidget",function(D,h){function E(){for(var b=jQuery.data(h,"obj"),d="",l=0;l<b.jsValues.length;l++){d+=l+":";for(var o=0;o<b.jsValues[l].length;o++){d+=b.jsValues[l][o];d+=o!==b.jsValues[l].length-1?",":";"}}return d}jQuery.data(h,"obj",this);var w=this,g=D.WT,p=g.glMatrix.vec3,j=g.glMatrix.mat4;this.ctx=null;this.initializeGL=function(){};this.paintGL=function(){};this.resizeGL=function(){};this.updates=[];this.initialized=false;this.preloadingBuffers=
this.preloadingTextures=0;this.jsValues=[];this.discoverContext=function(b,d){if(h.getContext){try{this.ctx=h.getContext("webgl",{antialias:d})}catch(l){}if(this.ctx===null)try{this.ctx=h.getContext("experimental-webgl",{antialias:d})}catch(o){}if(this.ctx===null){h.parentNode.insertBefore(h.firstChild,h);h.style.display="none";b()}}return this.ctx};if(h.addEventListener){h.addEventListener("webglcontextlost",function(b){b.preventDefault();w.initialized=false},false);h.addEventListener("webglcontextrestored",
function(){Wt.emit(h,"contextRestored")},false)}var e=null;this.setMouseHandler=function(b){e=b;e.setTarget&&e.setTarget(this)};this.LookAtMouseHandler=function(b,d,l,o,x){function y(c){c=Math.pow(1.2,c);j.translate(f,i);j.scale(f,[c,c,c]);p.negate(i);j.translate(f,i);p.negate(i);w.paintGL()}function B(c){var a=f[5]/p.length([f[1],f[5],f[9]]),m=f[6]/p.length([f[2],f[6],f[10]]);a=Math.atan2(m,a);m=c.x-q.x;var v=c.y-q.y,z=p.create();z[0]=f[0];z[1]=f[4];z[2]=f[8];var r=j.create();j.identity(r);j.translate(r,
i);v=v*s;if(Math.abs(a+v)>=Math.PI/2)v=(a>0?1:-1)*Math.PI/2-a;j.rotate(r,v,z);j.rotate(r,m*F,k);p.negate(i);j.translate(r,i);p.negate(i);j.multiply(f,r,f);w.paintGL();q=c}var f=b,i=d,k=l,s=o,F=x,C=null,t=null,u=null,q=null;this.mouseDown=function(c,a){g.capture(null);g.capture(h);q=g.pageCoordinates(a)};this.mouseUp=function(){if(q!==null)q=null};this.mouseDrag=function(c,a){if(q!==null){c=g.pageCoordinates(a);g.buttons===1&&B(c)}};this.mouseWheel=function(c,a){g.cancelEvent(a);c=g.wheelDelta(a);
y(c)};this.touchStart=function(c,a){t=a.touches.length===1?true:false;u=a.touches.length===2?true:false;if(t){g.capture(null);g.capture(h);q=g.pageCoordinates(a.touches[0])}else if(u){c=g.pageCoordinates(a.touches[0]);var m=g.pageCoordinates(a.touches[1]);C=Math.sqrt((c.x-m.x)*(c.x-m.x)+(c.y-m.y)*(c.y-m.y))}else return;a.preventDefault()};this.touchEnd=function(c,a){var m=a.touches.length===0?true:false;t=a.touches.length===1?true:false;u=a.touches.length===2?true:false;m&&this.mouseUp(null,null);
if(t||u)this.touchStart(c,a)};this.touchMoved=function(c,a){if(t||u){a.preventDefault();t&&this.mouseDrag(c,a.touches[0]);if(u){c=g.pageCoordinates(a.touches[0]);a=g.pageCoordinates(a.touches[1]);a=Math.sqrt((c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y));c=a/C;if(!(Math.abs(c-1)<0.05)){c=c>1?1:-1;C=a;y(c)}}}}};this.WalkMouseHandler=function(b,d,l){function o(i){var k=i.x-f.x;i=i.y-f.y;var s=j.create();j.identity(s);j.rotateY(s,k*B);k=p.create();k[0]=0;k[1]=0;k[2]=-y*i;j.translate(s,k);j.multiply(s,x,x);
w.paintGL();f=g.pageCoordinates(event)}var x=b,y=d,B=l,f=null;this.mouseDown=function(i,k){g.capture(null);g.capture(h);f=g.pageCoordinates(k)};this.mouseUp=function(){if(f!==null)f=null};this.mouseDrag=function(i,k){if(f!==null){i=g.pageCoordinates(k);o(i)}}};this.mouseDrag=function(b,d){if((this.initialized||!this.ctx)&&e&&e.mouseDrag)e.mouseDrag(b,d)};this.mouseMove=function(b,d){if((this.initialized||!this.ctx)&&e&&e.mouseMove)e.mouseMove(b,d)};this.mouseDown=function(b,d){if((this.initialized||
!this.ctx)&&e&&e.mouseDown)e.mouseDown(b,d)};this.mouseUp=function(b,d){if((this.initialized||!this.ctx)&&e&&e.mouseUp)e.mouseUp(b,d)};this.mouseWheel=function(b,d){if((this.initialized||!this.ctx)&&e&&e.mouseWheel)e.mouseWheel(b,d)};this.touchStart=function(b,d){if((this.initialized||!this.ctx)&&e&&e.touchStart)e.touchStart(b,d)};this.touchEnd=function(b,d){if((this.initialized||!this.ctx)&&e&&e.touchEnd)e.touchEnd(b,d)};this.touchMoved=function(b,d){if((this.initialized||!this.ctx)&&e&&e.touchMoved)e.touchMoved(b,
d)};this.handlePreload=function(){if(this.preloadingTextures===0&&this.preloadingBuffers===0){if(this.initialized){var b;for(b in this.updates)this.updates[b]();this.updates=[]}else this.initializeGL();this.resizeGL();this.paintGL()}};h.wtEncodeValue=E;var A=null,n=new Image;n.busy=false;n.onload=function(){h.src=n.src;if(A!=null)n.src=A;else n.busy=false;A=null};n.onerror=n.onload;this.loadImage=function(b){if(n.busy)A=b;else{n.src=b;n.busy=true}}});
